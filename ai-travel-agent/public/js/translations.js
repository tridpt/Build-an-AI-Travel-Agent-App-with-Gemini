const translations = {
    vi: {
        title: 'ðŸŒ AI Travel Agent',
        subtitle: 'Trá»£ lÃ½ du lá»‹ch thÃ´ng minh vá»›i Google Gemini',
        tabPlan: 'ðŸ“‹ LÃªn Káº¿ Hoáº¡ch',
        tabChat: 'ðŸ’¬ Chat Tá»± Do',
        tabCurrency: 'ðŸ’± Chuyá»ƒn Ä‘á»•i tiá»n tá»‡',
        currencyConverterTitle: 'ðŸ’± CÃ´ng cá»¥ chuyá»ƒn Ä‘á»•i tiá»n tá»‡',
        amountLabel: 'Sá»‘ tiá»n',
        fromLabel: 'Tá»«',
        toLabel: 'Sang',
        convertButton: 'Chuyá»ƒn Ä‘á»•i',
        formTitle: 'ðŸŽ¯ ThÃ´ng tin chuyáº¿n Ä‘i cá»§a báº¡n',
        startLocation: 'ðŸ›« NÆ¡i báº¯t Ä‘áº§u?',
        startLocationPlaceholder: 'VÃ­ dá»¥: HÃ  Ná»™i, TP.HCM, ÄÃ  Náºµng...',
        errorStartLocation: 'Vui lÃ²ng nháº­p nÆ¡i báº¯t Ä‘áº§u!',
        destination: 'ðŸ“ Báº¡n muá»‘n Ä‘i Ä‘Ã¢u?',
        destinationPlaceholder: 'VÃ­ dá»¥: ÄÃ  Láº¡t, PhÃº Quá»‘c, Tokyo...',
        destinationHint: 'CÃ³ thá»ƒ Ä‘á»ƒ trá»‘ng náº¿u muá»‘n AI gá»£i Ã½',
        startDate: 'ðŸ“… NgÃ y báº¯t Ä‘áº§u',
        endDate: 'ðŸ“… NgÃ y káº¿t thÃºc',
        budget: 'ðŸ’° NgÃ¢n sÃ¡ch',
        budgetPlaceholder: 'VÃ­ dá»¥: 5000000',
        budgetCurrencyLabel: 'ÄÆ¡n vá»‹',
        travelers: 'ðŸ‘¥ Sá»‘ ngÆ°á»i Ä‘i',
        travelersPlaceholder: 'Sá»‘ ngÆ°á»i',
        travelStyle: 'ðŸŽ¨ Phong cÃ¡ch du lá»‹ch',
        selectStyle: '-- Chá»n phong cÃ¡ch --',
        styleBudget: 'ðŸŽ’ Tiáº¿t kiá»‡m (Backpacker)',
        styleComfort: 'ðŸ¨ Thoáº£i mÃ¡i (KhÃ¡ch sáº¡n 3-4 sao)',
        styleLuxury: 'âœ¨ Cao cáº¥p (Resort 5 sao)',
        styleAdventure: 'ðŸ”ï¸ PhiÃªu lÆ°u, Máº¡o hiá»ƒm',
        styleRelax: 'ðŸ–ï¸ Nghá»‰ dÆ°á»¡ng',
        styleCulture: 'ðŸ›ï¸ VÄƒn hÃ³a, Lá»‹ch sá»­',
        styleFood: 'ðŸœ áº¨m thá»±c',
        interests: 'â¤ï¸ Sá»Ÿ thÃ­ch (chá»n nhiá»u)',
        interestBeach: 'ðŸ–ï¸ Biá»ƒn',
        interestMountain: 'â›°ï¸ NÃºi',
        interestCity: 'ðŸ™ï¸ ThÃ nh phá»‘',
        interestNature: 'ðŸŒ¿ ThiÃªn nhiÃªn',
        interestShopping: 'ðŸ›ï¸ Mua sáº¯m',
        interestFood: 'ðŸ½ï¸ áº¨m thá»±c',
        interestNightlife: 'ðŸŒƒ Nightlife',
        interestHistory: 'ðŸ›ï¸ Lá»‹ch sá»­',
        transportation: 'ðŸš— PhÆ°Æ¡ng tiá»‡n di chuyá»ƒn',
        selectTransport: '-- Chá»n phÆ°Æ¡ng tiá»‡n --',
        transportPlane: 'âœˆï¸ MÃ¡y bay',
        transportBus: 'ðŸšŒ Xe khÃ¡ch',
        transportTrain: 'ðŸš„ TÃ u há»a',
        transportCar: 'ðŸš— Xe Ã´ tÃ´ (tá»± lÃ¡i)',
        transportMotorbike: 'ðŸï¸ Xe mÃ¡y',
        transportAny: 'ðŸ¤· TÃ¹y Ã½',
        additionalInfo: 'ðŸ“ YÃªu cáº§u khÃ¡c (tÃ¹y chá»n)',
        additionalPlaceholder: 'VÃ­ dá»¥: Muá»‘n á»Ÿ homestay, thÃ­ch chá»¥p áº£nh, Ä‘i cÃ¹ng tráº» em...',
        generateButton: 'âœ¨ Táº¡o Lá»‹ch TrÃ¬nh Du Lá»‹ch',
        generating: 'â³ Äang táº¡o lá»‹ch trÃ¬nh...',
        exportButton: 'Xuáº¥t File',
        resultTitle: 'ðŸŽ‰ Lá»‹ch trÃ¬nh cá»§a báº¡n',
        editButton: 'âœï¸ Chá»‰nh sá»­a',
        shareButton: 'ðŸ“¤ Chia sáº»', 
        noItineraryToShare: 'ChÆ°a cÃ³ lá»‹ch trÃ¬nh Ä‘á»ƒ chia sáº»!', 
        tabFlight: 'âœˆï¸ TÃ¬m chuyáº¿n bay',
        flightSearchTitle: 'âœˆï¸ TÃ¬m kiáº¿m chuyáº¿n bay',
        fromAirportLabel: 'SÃ¢n bay Ä‘i (IATA)',
        toAirportLabel: 'SÃ¢n bay Ä‘áº¿n (IATA)',
        flightDateLabel: 'NgÃ y bay',
        searchFlightButton: 'TÃ¬m kiáº¿m',
        flightResultsTitle: 'Káº¿t quáº£ tÃ¬m kiáº¿m',
        chatPlaceholder: 'Há»i gÃ¬ Ä‘Ã³ vá» du lá»‹ch...',
        sendButton: 'Gá»­i',
        welcomeMessage: 'Xin chÃ o! TÃ´i lÃ  trá»£ lÃ½ du lá»‹ch AI. HÃ£y há»i tÃ´i vá» cÃ¡c Ä‘iá»ƒm Ä‘áº¿n, khÃ¡ch sáº¡n, hoáº¡t Ä‘á»™ng hoáº·c lá»i khuyÃªn du lá»‹ch!',
        bookingLabel: 'Äáº·t phÃ²ng',
        searchLabel: 'TÃ¬m kiáº¿m',
        errorDate: 'Vui lÃ²ng chá»n ngÃ y báº¯t Ä‘áº§u vÃ  káº¿t thÃºc!',
        errorBudget: 'Vui lÃ²ng nháº­p ngÃ¢n sÃ¡ch!',
        errorStyle: 'Vui lÃ²ng chá»n phong cÃ¡ch du lá»‹ch!',
        errorEndDate: 'NgÃ y káº¿t thÃºc pháº£i sau ngÃ y báº¯t Ä‘áº§u!',
        errorPlan: 'KhÃ´ng thá»ƒ táº¡o lá»‹ch trÃ¬nh. Vui lÃ²ng thá»­ láº¡i!',
        errorConnection: 'Lá»—i káº¿t ná»‘i Ä‘áº¿n server!'
    },
    en: {
        title: 'ðŸŒ AI Travel Agent',
        subtitle: 'Smart Travel Assistant powered by Google Gemini',
        tabPlan: 'ðŸ“‹ Plan Trip',
        tabChat: 'ðŸ’¬ Free Chat',
        tabCurrency: 'ðŸ’± Currency Converter',
        currencyConverterTitle: 'ðŸ’± Currency Converter',
        amountLabel: 'Amount',
        fromLabel: 'From',
        toLabel: 'To',
        convertButton: 'Convert',
        formTitle: 'ðŸŽ¯ Your Trip Information',
        startLocation: 'ðŸ›« Starting From?',
        startLocationPlaceholder: 'e.g., Hanoi, Ho Chi Minh City, London...',
        errorStartLocation: 'Please enter a starting location!',
        destination: 'ðŸ“ Where do you want to go?',
        destinationPlaceholder: 'e.g., Paris, Tokyo, Bali...',
        destinationHint: 'Leave blank for AI suggestions',
        startDate: 'ðŸ“… Start Date',
        endDate: 'ðŸ“… End Date',
        budget: 'ðŸ’° Budget',
        budgetPlaceholder: 'e.g., 500',
        budgetCurrencyLabel: 'Currency',
        travelers: 'ðŸ‘¥ Number of Travelers',
        travelersPlaceholder: 'Number',
        travelStyle: 'ðŸŽ¨ Travel Style',
        selectStyle: '-- Select Style --',
        styleBudget: 'ðŸŽ’ Budget (Backpacker)',
        styleComfort: 'ðŸ¨ Comfort (3-4 star hotels)',
        styleLuxury: 'âœ¨ Luxury (5-star resorts)',
        styleAdventure: 'ðŸ”ï¸ Adventure',
        styleRelax: 'ðŸ–ï¸ Relaxation',
        styleCulture: 'ðŸ›ï¸ Culture & History',
        styleFood: 'ðŸœ Food & Cuisine',
        interests: 'â¤ï¸ Interests (select multiple)',
        interestBeach: 'ðŸ–ï¸ Beach',
        interestMountain: 'â›°ï¸ Mountain',
        interestCity: 'ðŸ™ï¸ City',
        interestNature: 'ðŸŒ¿ Nature',
        interestShopping: 'ðŸ›ï¸ Shopping',
        interestFood: 'ðŸ½ï¸ Food',
        interestNightlife: 'ðŸŒƒ Nightlife',
        interestHistory: 'ðŸ›ï¸ History',
        transportation: 'ðŸš— Transportation',
        selectTransport: '-- Select Transport --',
        transportPlane: 'âœˆï¸ Airplane',
        transportBus: 'ðŸšŒ Bus',
        transportTrain: 'ðŸš„ Train',
        transportCar: 'ðŸš— Car (self-drive)',
        transportMotorbike: 'ðŸï¸ Motorbike',
        transportAny: 'ðŸ¤· Any',
        additionalInfo: 'ðŸ“ Additional Requirements (optional)',
        additionalPlaceholder: 'e.g., Prefer homestays, love photography, traveling with kids...',
        generateButton: 'âœ¨ Generate Travel Plan',
        generating: 'â³ Generating plan...',
        exportButton: 'Export File',
        resultTitle: 'ðŸŽ‰ Your Itinerary',
        editButton: 'âœï¸ Edit',
        shareButton: 'ðŸ“¤ Share',
        noItineraryToShare: 'No itinerary to share!', 
        tabFlight: 'âœˆï¸ Flight Search',
        flightSearchTitle: 'âœˆï¸ Flight Search',
        fromAirportLabel: 'Departure Airport (IATA)',
        toAirportLabel: 'Arrival Airport (IATA)',
        flightDateLabel: 'Flight Date',
        searchFlightButton: 'Search',
        flightResultsTitle: 'Search Results',
        chatPlaceholder: 'Ask something about travel...',
        sendButton: 'Send',
        welcomeMessage: 'Hello! I\'m your AI travel assistant. Ask me about destinations, hotels, activities, or travel advice!',
        bookingLabel: 'Booking',
        searchLabel: 'Search',
        errorDate: 'Please select start and end dates!',
        errorBudget: 'Please enter a budget!',
        errorStyle: 'Please select a travel style!',
        errorEndDate: 'End date must be after start date!',
        errorPlan: 'Cannot generate plan. Please try again!',
        errorConnection: 'Error connecting to server!'
    }
};

let currentLang = 'vi';

function t(key) {
    return translations[currentLang][key] || key;
}

function switchLanguage(lang) {
    currentLang = lang;
    updateUIText();
    // This function will now be called from formHandler to ensure it has the correct currency
    // updateBudgetDisplay(); 
    if (typeof formHandler !== 'undefined' && formHandler) {
        formHandler.updateBudgetDisplay();
    }
    updateWelcomeMessage();
    
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.getElementById(`lang-${lang}`).classList.add('active');
    
    localStorage.setItem('preferredLanguage', lang);
}

function updateUIText() {
    document.querySelectorAll('[data-i18n]').forEach(elem => {
        const key = elem.getAttribute('data-i18n');
        if (elem.tagName === 'INPUT' || elem.tagName === 'TEXTAREA') {
            if (elem.placeholder) elem.placeholder = t(key);
        } else {
            elem.textContent = t(key);
        }
    });
    
    const travelStyleSelect = document.getElementById('travelStyle');
    if (travelStyleSelect) {
        const selectedValue = travelStyleSelect.value;
        travelStyleSelect.innerHTML = `
            <option value="">${t('selectStyle')}</option>
            <option value="budget">${t('styleBudget')}</option>
            <option value="comfort">${t('styleComfort')}</option>
            <option value="luxury">${t('styleLuxury')}</option>
            <option value="adventure">${t('styleAdventure')}</option>
            <option value="relax">${t('styleRelax')}</option>
            <option value="culture">${t('styleCulture')}</option>
            <option value="food">${t('styleFood')}</option>
        `;
        travelStyleSelect.value = selectedValue;
    }
    
    const transportSelect = document.getElementById('transportation');
    if (transportSelect) {
        const selectedValue = transportSelect.value;
        transportSelect.innerHTML = `
            <option value="">${t('selectTransport')}</option>
            <option value="plane">${t('transportPlane')}</option>
            <option value="bus">${t('transportBus')}</option>
            <option value="train">${t('transportTrain')}</option>
            <option value="car">${t('transportCar')}</option>
            <option value="motorbike">${t('transportMotorbike')}</option>
            <option value="any">${t('transportAny')}</option>
        `;
        transportSelect.value = selectedValue;
    }
    
    const checkboxes = [
        { value: 'beach', key: 'interestBeach' },
        { value: 'mountain', key: 'interestMountain' },
        { value: 'city', key: 'interestCity' },
        { value: 'nature', key: 'interestNature' },
        { value: 'shopping', key: 'interestShopping' },
        { value: 'food', key: 'interestFood' },
        { value: 'nightlife', key: 'interestNightlife' },
        { value: 'history', key: 'interestHistory' }
    ];
    
    checkboxes.forEach(({ value, key }) => {
        const checkbox = document.querySelector(`input[type="checkbox"][value="${value}"]`);
        if (checkbox && checkbox.nextElementSibling) {
            checkbox.nextElementSibling.textContent = t(key);
        }
    });
}

// This function is now in formHandler.js to access currency value directly.

function updateWelcomeMessage() {
    const chatMessages = document.getElementById('chatMessages');
    if (chatMessages && chatMessages.children.length > 0) {
        const firstMessage = chatMessages.children[0];
        if (firstMessage.classList.contains('bot-message')) {
            firstMessage.textContent = t('welcomeMessage');
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const savedLang = localStorage.getItem('preferredLanguage') || 'vi';
    switchLanguage(savedLang);
});